{% extends 'layouts/main.swig' %}

{% block head %}
{% parent %}
  <title>Fuel Rats Leaderboard</title>
{% endblock %}

{% block body %}
{% parent %}
<div class="container-fluid">
  <h1>Leaderboard</h1>
  <div class="row leaderboard-overview">
    <div id="leaderboard-container" class="col-md-6">
      <div class="card-header">
      </div>
      <table id="leaderboard" class="table table-hover table-striped">
        <thead>
          <tr>
            <th>CMDR</th>
            <th>Rescues</th>
            <th>Achievements</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
            <tr>
              <td>{{ user.rats[0] }} </td>
              <td>{{ user.rescueCount }}</td>
              <td>
              {{ badge("rat") }}
              {% if user.epicRescues[0] %}
              {{ badge("epic") }}
              {% endif %}
              {% if user.codeRed == true %}
              {{ badge("codeRed") }}
              {% endif %}
              {% if user.drilledDispatch == true %}
              {{ badge("dispatch") }}
              {% endif %}
              {% for i in Array(user.pips) %}
                {{ badge("pip") }}
              {% endfor %}
              {% if user.rescueCount >= 1000 %}
              {{ badge("1000") }}
              {% endif %}
              {% if user.joined|date('Y') == 2015 %}
              {{ badge("3301") }}
              {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="col-md-6">
      <div class="row">
        <div id="overview-container" class="col-md-12">
          <div id="overview">
            <div class="container-fluid">
              <div class="col-md-12 bg-primary">
                <h1>{{ overview.successRate }}% success</h1>
              </div>
              <div class="col-md-7 bg-success">
                <h3>{{ overview.successCount }} successful</h3>
              </div>
                <div class="col-md-5 bg-danger">
                  <h3>{{ overview.failureCount }} failed</h3>
                </div>
            </div>
          </div>
        </div>
        <div id="rescues-by-date-container" class="col-md-12">
          <div class="card-header">
            Rescues over time
          </div>
          <svg id="rescues-by-date"></svg>
        </div>
      </div>
      <div class="row">
        <div id="rescues-by-system-container" class="col-md-12">
          <div class="card-header">
            Rescues by system
          </div>
          <div class="card-block">
            <svg id="rescues-by-system"></svg>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block resources %}
{% parent %}
<script src="//d3js.org/d3.v3.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/tether/1.2.0/js/tether.min.js"></script>
<script src="js/leaderboard.js"></script>
{% endblock %}

{% macro badge(type) %}
  {% if type == 'rat' %}
  <img src="svg/rat.svg" alt="Fuel Rat Badge" title="This rat has completed a rescue" class="lbBadge">
  {% endif  %}
  {% if type == 'codeRed' %}
  <img src="svg/codeRed.svg" alt="Code Red Badge" title="This rat has completed a code red rescue" class="lbBadge">
  {% endif  %}
  {% if type == 'dispatch' %}
  <img src="svg/dispatch.svg" alt="Dispatch Badge" title="This rat has dispatched a rescue" class="lbBadge">
  {% endif  %}
  {% if type == 'epic' %}
  <img src="svg/epic.svg" alt="Epic Badge" title="This rat has completed an epic rescue or other epic achievement" class="lbBadge">
  {% endif  %}
  {% if type == 'pip' %}
  <img src="svg/pip.svg" alt="100 Rescues Pip" title="Each pip represents 100 rescues the rat has completed" class="lbBadge">
  {% endif  %}
  {% if type == '1000' %}
  <img src="svg/1000.svg" alt="Epic Badge" title="This rat has completed over 1000 rescues" class="lbBadge">
  {% endif  %}
  {% if type == '3301' %}
  <img src="svg/3301.svg" alt="3301 Badge" title="This rat completed a rescue in year 3301" class="lbBadge">
  {% endif  %}
{% endmacro %}
